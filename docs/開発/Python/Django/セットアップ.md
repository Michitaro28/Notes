# Djangoのセットアップと概要

## package
- uvを使用

仮想環境の作成

```uv
uv venv
```

仮想環境の有効化

=== "macOS"

    ```bash
    source .venv/bin/activate
    ```

=== "Windows"

    ```bash
    .venv\Scripts\activate
    ```



## 仮想環境作成後のセットアップ

1. Djangoのインストール

``` uv
uv pip install django
```


2. Djangoプロジェクトの作成

```
django-admin startproject <project name>
```

3. Djangoアプリケーションの作成（任意）

```
python manage.py startapp <app name>
```

4. DBマイグレーション

```
python manege.py migrate
```

5. スーパーユーザーの作成(管理用画面)

```
python manage.py createsuperuser
```

6. 開発サーバーの起動

```
python manage.py runserver
```

- port が埋まっている場合は、runserverの後にport指定をする。

```
python manage.py runserver <port番号>
```

## appの作成と登録

appコマンド実行後、djago/settings.pyに作成したappを登録する。

```python
# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'helloapp', #作ったappを追記
]

```

## アプリケーションurls.pyの作成
Djangoでは、アプリケーションごとにURLのルーティング（どのURLで処理を行うか）を管理するために、urls.pyというファイルを自分で作る必要がある。

app/urls.py

```python
# urlパターンを定義するためのpath関数をインポート
from django.urls import path
#　現在のディレクトリからviewsモジュールをインポート
from . import views

urlpatterns = [
    # 'hello/'がリクエストされたとき、
    # viewsモジュールのshow_hello関数を呼び出す。
    path('hello/', views.show_hello, name='hello')
]
```

## プロジェクトurls.pyの修正
Djangoでは、プロジェクト全体のurls.pyに個別アプリのURLルールを追加する際に「include()関数」を使って **この先はアプリのルールに任せます。** と指定します。

myproject/urls.py

```python
# Django管理サイト用のモジュールをインポート
from django.contrib import admin
# urlパターンを定義するためのpath関数とinclude関数をインポート
from django.urls import path, include

urlpatterns = [
    # 'admin/'がリクエストされたとき、Djangoの管理サイトを表示する。
    path('admin/', admin.site.urls),
    # 'exe01/'がリクエストされたとき、helloappアプリケーションのurlsモジュールを参照する。
    path('exe01/', include('helloapp.urls')),
]
```

## アプリケーションviews.pyの修正
アプリケーション側のviews.pyの修正を行う

app/views.py

```python
# HttpResponseクラスをインポート
from django.http import HttpResponse


# --------------------------------
# ビュー関数を定義
# "ハロー、Django!"というテキストを含むHTTPレスポンスを返す
# --------------------------------

def show_hello(request):
    return HttpResponse("ハロー、Django!")
```

**Djangoのビュー関数はrequest引数をとる**
Djangoのビュー関数は必ずrequest関数を取ります。この「request」は、ユーザーからのHTTPリクエスト（クライアントからサーバーからに送られるデータ要求）を表します。

- request引数の特徴
**プロコトルの一貫性**
Djangoフレームワークは、ビュー関数がHTTPリクエストオブジェクトを引数として、受け取ることを前提としています。これによりDjangoはリクエストに対するリスポンスを適切に処理します。

**リクエスト情報へのアクセス**
ビュー関数内でrequest引数を使用することで、ユーザーのリクエストに関する情報（例：GET/POSTデータ、クッキー、セッションデータなど）にアクセスできます。


## サーバーの起動と確認

manage.pyのあるディレクトリに移動し、下記のコマンドを実行

```bash
python manage.py runserver
```

ブラウザにアクセス後、指定したURL、ここでは、「http://loclahost:8000/exe01/hello/」を入力し、表示を確認する。


## Djangoの2つの書き方
Djangonには2つの書き方がある。
- 関数ベースビュー（FBV）
- クラスベースビュー（CBV）

|ビューの種類|詳細|
| :-- | :-- |
|FBV|関数を使ってビューを定義する方法。上記に示した例（helloapp）|
|CBV|クラスを使ってビューを定義する方法。より柔軟で再利用性の高い設計が可能です。|